<!--pages/index/index.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <text class="nav-title">åŸå¸‚äº¤é€šéœ€æ±‚åˆ†æç³»ç»Ÿ</text>
  </view>

  <!-- æ•°æ®æ¦‚è§ˆå¡ç‰‡åŒºåŸŸ -->
  <view class="overview-section">
    <view class="section-title">
      <text class="title-text">æ•°æ®æ¦‚è§ˆ</text>
      <text class="subtitle-text">2021å¹´5æœˆæ·±åœ³å¸‚å…±äº«å•è½¦éœ€æ±‚åˆ†æ</text>
    </view>
    
    <view class="stats-grid">
      <!-- æ€»ç«™ç‚¹æ•° -->
      <view class="stat-card">
        <view class="stat-icon">
          <image src="../../images/station-icon.png" mode="aspectFit"></image>
        </view>
        <view class="stat-content">
          <text class="stat-value">{{overviewData.totalStations}}</text>
          <text class="stat-label">æ€»ç«™ç‚¹æ•°</text>
        </view>
      </view>

      <!-- æ•°æ®å¤©æ•° -->
      <view class="stat-card">
        <view class="stat-icon">
          <image src="../../images/calendar-icon.png" mode="aspectFit"></image>
        </view>
        <view class="stat-content">
          <text class="stat-value">{{overviewData.dataDays}}</text>
          <text class="stat-label">æ•°æ®å¤©æ•°</text>
        </view>
      </view>

      <!-- æ€»éœ€æ±‚é‡ -->
      <view class="stat-card">
        <view class="stat-icon">
          <image src="../../images/demand-icon.png" mode="aspectFit"></image>
        </view>
        <view class="stat-content">
          <text class="stat-value">{{overviewData.totalDemandDisplay}}</text>
          <text class="stat-label">æ€»éœ€æ±‚é‡</text>
        </view>
      </view>

      <!-- å¹³å‡æ—¥éœ€æ±‚ -->
      <view class="stat-card">
        <view class="stat-icon">
          <image src="../../images/average-icon.png" mode="aspectFit"></image>
        </view>
        <view class="stat-content">
          <text class="stat-value">{{overviewData.avgDailyDemandDisplay}}</text>
          <text class="stat-label">å¹³å‡æ—¥éœ€æ±‚</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åœ°å›¾å±•ç¤ºåŒºåŸŸ -->
  <view class="map-section">
    <view class="section-title">
      <text class="title-text">ç«™ç‚¹åˆ†å¸ƒåœ°å›¾</text>
      <view class="map-legend">
        <view class="legend-item">
          <view class="legend-color low"></view>
          <text>ä½éœ€æ±‚</text>
        </view>
        <view class="legend-item">
          <view class="legend-color medium"></view>
          <text>ä¸­éœ€æ±‚</text>
        </view>
        <view class="legend-item">
          <view class="legend-color high"></view>
          <text>é«˜éœ€æ±‚</text>
        </view>
        <view class="legend-item">
          <view class="legend-color very-high"></view>
          <text>è¶…é«˜éœ€æ±‚</text>
        </view>
      </view>
    </view>

    <!-- è…¾è®¯åœ°å›¾ç»„ä»¶ -->
    <map 
      id="stationMap" 
      class="station-map"
      latitude="{{mapCenter.latitude}}"
      longitude="{{mapCenter.longitude}}"
      scale="{{mapScale}}"
      markers="{{markers}}"
      show-location="{{true}}"
      bindmarkertap="onMarkerTap"
      bindregionchange="onRegionChange"
    >
      <!-- åœ°å›¾æ§ä»¶ -->
      <cover-view class="map-controls">
        <cover-view class="control-btn" bindtap="resetMapCenter">
          <cover-image src="../../images/location-icon.png" class="control-icon"></cover-image>
        </cover-view>
      </cover-view>
    </map>

    <!-- ç«™ç‚¹ä¿¡æ¯å¼¹çª— -->
    <view class="station-info-popup" wx:if="{{showStationInfo}}">
      <view class="popup-mask" bindtap="closeStationInfo"></view>
      <view class="popup-content">
        <view class="popup-header">
          <text class="station-name">{{selectedStation.name}}</text>
          <view class="close-btn" bindtap="closeStationInfo">
            <text>Ã—</text>
          </view>
        </view>
        <view class="popup-body">
          <view class="info-row">
            <text class="info-label">ç«™ç‚¹IDï¼š</text>
            <text class="info-value">{{selectedStation.stationId}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">ä½ç½®ï¼š</text>
            <text class="info-value">{{selectedStation.address}}</text>
          </view>
          <view class="info-row">
            <text class="info-label">æ€»éœ€æ±‚é‡ï¼š</text>
            <text class="info-value highlight">{{selectedStation.totalDemand}} æ¬¡</text>
          </view>
          <view class="info-row">
            <text class="info-label">å¹³å‡éœ€æ±‚ï¼š</text>
            <text class="info-value">{{selectedStation.avgDemand}} æ¬¡/å°æ—¶</text>
          </view>
          <view class="info-row">
            <text class="info-label">éœ€æ±‚ç­‰çº§ï¼š</text>
            <text class="info-value demand-level-{{selectedStation.demandLevel}}">
              {{selectedStation.demandLevelText}}
            </text>
          </view>
        </view>
        <view class="popup-footer">
          <button class="detail-btn" bindtap="goToStationDetail">æŸ¥çœ‹è¯¦æƒ…</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£åŒºåŸŸ -->
  <view class="quick-access-section">
    <view class="section-title">
      <text class="title-text">å¿«æ·åŠŸèƒ½</text>
    </view>

    <view class="quick-grid">
      <!-- çƒ­é—¨ç«™ç‚¹Top10 -->
      <view class="quick-card" bindtap="goToHotStations">
        <view class="quick-icon hot">
          <text class="icon-text">ğŸ”¥</text>
        </view>
        <text class="quick-title">çƒ­é—¨ç«™ç‚¹</text>
        <text class="quick-subtitle">Top 10æ’è¡Œæ¦œ</text>
      </view>

      <!-- ä»Šæ—¥æ¨èåˆ†æ -->
      <view class="quick-card" bindtap="goToDailyInsight">
        <view class="quick-icon insight">
          <text class="icon-text">ğŸ’¡</text>
        </view>
        <text class="quick-title">ä»Šæ—¥æ¨è</text>
        <text class="quick-subtitle">æ™ºèƒ½åˆ†ææŠ¥å‘Š</text>
      </view>

      <!-- æ•°æ®åˆ†æ -->
      <view class="quick-card" bindtap="goToAnalysis">
        <view class="quick-icon analysis">
          <text class="icon-text">ğŸ“Š</text>
        </view>
        <text class="quick-title">æ•°æ®åˆ†æ</text>
        <text class="quick-subtitle">æ—¶ç©ºåˆ†ææŠ¥å‘Š</text>
      </view>

      <!-- è¶‹åŠ¿æŠ¥å‘Š -->
      <view class="quick-card" bindtap="goToTrends">
        <view class="quick-icon trends">
          <text class="icon-text">ğŸ“ˆ</text>
        </view>
        <text class="quick-title">è¶‹åŠ¿æŠ¥å‘Š</text>
        <text class="quick-subtitle">éœ€æ±‚è¶‹åŠ¿é¢„æµ‹</text>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘æŸ¥çœ‹ -->
  <view class="recent-section" wx:if="{{recentStations.length > 0}}">
    <view class="section-title">
      <text class="title-text">æœ€è¿‘æŸ¥çœ‹</text>
      <text class="more-btn" bindtap="clearRecent">æ¸…ç©º</text>
    </view>

    <scroll-view class="recent-scroll" scroll-x="true">
      <view class="recent-item" wx:for="{{recentStations}}" wx:key="stationId" bindtap="goToStationDetail" data-station-id="{{item.stationId}}">
        <view class="recent-icon" style="background-color: {{item.color}};">
          <text>{{item.stationId}}</text>
        </view>
        <text class="recent-name">{{item.name}}</text>
        <text class="recent-time">{{item.viewTime}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
